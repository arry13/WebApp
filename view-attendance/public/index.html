<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Employee Utilization Overview</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>

    <header>
        <img src="https://www.1min30.com/logo/wp-content/uploads/2018/05/Embl%C3%A8me-Capgemini.jpg" alt="Capgemini Logo" class="logo">
        <h1>Monthly Employee Utilization Overview</h1>
    </header>

    <div class="container">
        <label id="selectmonth"for="monthSelect">Select Month:</label>
        <select id="monthSelect" onchange ="fetchData()">
            <option value="">--Select Month--</option>
             <option value="January">January</option>
            <option value="February">February</option>
            <option value="March">March</option>
            <option value="April">April</option>
            <option value="May">May</option>
            <option value="June">June</option>
            <option value="July">July</option>
            <option value="August">August</option>
            <option value="September">September</option>
            <option value="October">October</option>
            <option value="November">November</option>
            <option value="December">December</option>


        </select>

        


        <table id="dataTable" style="display:none;">
            <thead>
                <tr>
                    <th>Employee Name</th>
                    <th>Month</th>
                    <th>Working Days</th>
                    <th>Leaves</th>
                    <th>Net Working Days</th>
                    <th>Jira Tickets</th>
                    <th>Utilization (%)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <table id="dataTable1" style="display:none;">
            <thead>
                <tr>
                    <th>Capacity</th>
                    <th>Efforts</th>
                    <th>Utilization</th>
                    
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        function fetchData() {
            const Month = document.getElementById('monthSelect').value;
            if (!Month) {
                alert('Please select a month.');
                return;
            }

            // Fetch data from the backend
            fetch(`/fetch-data?Month=${Month}`)
                .then(response => response.json())
                .then(data => {
                    // Clear existing table rows
                    const tbody = document.querySelector('#dataTable tbody');
                    tbody.innerHTML = '';

                    if (data.length === 0) {
                        alert('No data found for the selected month.');
                        document.getElementById('dataTable').style.display = 'none';
                        return;
                    }

                    // Populate the table with the fetched data
                    data.forEach(row => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${row['Employee Name']}</td>
                            <td>${row['Month']}</td>
                            <td>${row['Working Days']}</td>
                            <td>${row['Leaves']}</td>
                            <td>${row['Net Working Days']}</td>
                            <td>${row['Jira Tickets']}</td>
                            <td>${row['Utilization (%)']}</td>
                        `;
                        tbody.appendChild(tr);
                    });

                    // Display the table
                    document.getElementById('dataTable').style.display = 'table';
                })

                //Fetch from capacity
                fetch(`/fetch1-data?Month=${Month}`)
                .then(response => response.json())
                .then(data1 => {
                    // Clear existing table rows
                    const tbody = document.querySelector('#dataTable1 tbody');
                    tbody.innerHTML = '';

                    if (data1.length === 0) {
                        alert('No data found for the selected month.');
                        document.getElementById('dataTable1').style.display = 'none';
                        return;
                    }

                    // Populate the table with the fetched data
                    data1.forEach(row => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${row['Capacity']}</td>
                            <td>${row['Efforts']}</td>
                            <td>${row['Utilization']}</td>
                            
                        `;
                        tbody.appendChild(tr);
                    });

                    // Display the table
                    document.getElementById('dataTable1').style.display = 'table';
                })
              
                .catch(error => {
                    console.error('Error fetching data:', error);
                    alert('An error occurred while fetching data.');
                });
        }
    </script>

</body>
</html>
